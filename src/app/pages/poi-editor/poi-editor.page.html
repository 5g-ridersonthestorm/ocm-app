<ion-header>
  <ion-toolbar>
    <ion-title>{{isAddMode?'Add Location':'Edit Location'}}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cancel()">
        <ion-icon name="close" slot="start"></ion-icon>
        Cancel
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-label>{{selectedTab}} - {{step}}</ion-label>
  <ng-container>

    <ion-segment [ngModel]="selectedTab">
      <ion-segment-button value="location" [disabled]="true" layout='icon-start'>
        <ion-icon *ngIf="selectedTab=='location'" name="arrow-dropright"></ion-icon>
        <ion-label>Location</ion-label>
      </ion-segment-button>
      <ion-segment-button value="equipment" [disabled]="true" layout='icon-start'>
        <ion-icon *ngIf="selectedTab=='equipment'" name="arrow-dropright"></ion-icon>
        <ion-label>Equipment</ion-label>
      </ion-segment-button>
      <ion-segment-button value="info" [disabled]="true" layout='icon-start'>
        <ion-icon *ngIf="selectedTab=='info'" name="arrow-dropright"></ion-icon>
        <ion-label>Info</ion-label>
      </ion-segment-button>
    </ion-segment>

    <ng-container *ngIf="selectedTab=='location'">
      <ng-container *ngIf="step=='location'">
        <app-poi-location-editor #editorMap
                                 [(latitude)]="item.AddressInfo.Latitude"
                                 [(longitude)]="item.AddressInfo.Longitude"
                                 (onUseSuggestedAddress)="useSuggestedAddress($event)"></app-poi-location-editor>


        <ion-list>
          <ion-item>
            <ion-label position="floating">Location Name</ion-label>
            <ion-input type="text" [(ngModel)]="item.AddressInfo.Title" placeholder="A title for this location"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Address Line 1</ion-label>
            <ion-input type="text" [(ngModel)]="item.AddressInfo.AddressLine1" placeholder="The nearest street address"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Address Line 2</ion-label>
            <ion-input type="text" [(ngModel)]="item.AddressInfo.AddressLine2" placeholder="Optional"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Town</ion-label>
            <ion-input type="text" [(ngModel)]="item.AddressInfo.Town" placeholder="Town or City"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">State or Province</ion-label>
            <ion-input type="text" [(ngModel)]="item.AddressInfo.StateOrProvince"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Postal Code</ion-label>
            <ion-input type="text" [(ngModel)]="item.AddressInfo.Postcode" placeholder="Optional Postal Code"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Country</ion-label>
            <ion-select [(ngModel)]="item.AddressInfo.CountryID" (ionChange)="onCountryChange()">
              <ion-select-option *ngFor="let c of countries" [value]="c.ID">{{c.Title}}</ion-select-option>
            </ion-select>

          </ion-item>
          <ion-item>
            <ion-label position="floating">Latitude</ion-label>
            <ion-input type="number" [(ngModel)]="item.AddressInfo.Latitude" placeholder="Latitude (if entering manually)"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Longitude</ion-label>
            <ion-input type="number" [(ngModel)]="item.AddressInfo.Longitude" placeholder="Longitude (if entering manually)"></ion-input>
          </ion-item>
        </ion-list>
      </ng-container>
      <ng-container *ngIf="step=='poi-nearby'">

        <h3>Locations Nearby</h3>
        <p><strong>The following locations already exist nearby.</strong></p>
        <div class="instruction">
          <p>Ensure you are not adding a duplicate site unless it is for different equipment from another network operator.</p>
          <p>You can edit any of these listings if required instead:</p>
        </div>

        <app-poi-list [poiList]='nearbySites' [enableEditOption]='true' (onEdit)='editPOI($event)'>
        </app-poi-list>

      </ng-container>

    </ng-container>
    <ng-container *ngIf="selectedTab=='equipment'">

      <ng-container *ngIf="step=='copy-equipment'">

        <ng-container *ngIf="!skipPOICopy">
          <p class="instruction">You can optionally copy the equipment settings from other sites operated by the same network operator:
            <ion-button (click)="skipCopyingPOI()" color="light" size="small">Skip<ion-icon name="fastforward" slot="end"></ion-icon>
            </ion-button>
          </p>

          <ion-item>
            <ion-label position="floating">Network Operator</ion-label>
            <ion-select [(ngModel)]="item.OperatorID" (ionChange)="onOperatorChange()">
              <ion-select-option *ngFor="let i of operators" [value]="i.ID">{{i.Title}}</ion-select-option>
              <ion-select-option value="-2">Other...</ion-select-option>
            </ion-select>
          </ion-item>

          <ng-container *ngIf="item.AddressInfo.CountryID && item.OperatorID">
            <ng-container *ngIf="selectedTemplatePOI">
              <p>Copied the equipment configuration from:</p>
              <ion-item>

                <ion-label>
                  {{selectedTemplatePOI.AddressInfo.Title}}
                  <br>
                  {{selectedTemplatePOI.AddressInfo.AddressLine1}}
                  <br>
                  {{selectedTemplatePOI.Connections[0].ConnectionType?.Title}}
                  <br>
                  {{selectedTemplatePOI.Connections[0].PowerKW}}
                  <br>
                  {{selectedTemplatePOI.DateCreated}}

                </ion-label>
                <ion-button slot="start" size="small" (click)="changeTemplatePOI()">Change..</ion-button>
              </ion-item>
            </ng-container>

            <ng-container *ngIf="!selectedTemplatePOI">
              <ng-container *ngIf="templateSites.length>0">

                <h2>Similar Sites</h2>
                <p>Copy the settings for a similar site, then adjust as required or select Advanced to provide more info:</p>
                <app-poi-list [enableCopyOption]='true' [poiList]='templateSites' (onCopy)='useTemplatePOI($event)'>

                </app-poi-list>
              </ng-container>

              <ng-container *ngIf="templateSites.length==0">
                <p>
                  There are no suggested sites to copy for this network operator. Use Advanced to enter the full site details.
                </p>
              </ng-container>
            </ng-container>


          </ng-container>
        </ng-container>

      </ng-container>

      <ng-container *ngIf="step=='edit-equipment'">
        <ion-item>
          <ion-label position="floating">Network Operator</ion-label>
          <ion-select [(ngModel)]="item.OperatorID">
            <ion-select-option *ngFor="let i of operators" [value]="i.ID">{{i.Title}}</ion-select-option>
            <ion-select-option value="-2">Other...</ion-select-option>
          </ion-select>

        </ion-item>


        <h4>Equipment</h4>

        <ion-button (click)="addConnection()" size="small">
          <ion-icon name="add" slot="icon-only"></ion-icon>
        </ion-button>

        <app-equipment-details [item]="item" [enableEdit]="true" (onEdit)="editConnection($event)" (onDelete)="deleteConnection($event)"></app-equipment-details>


      </ng-container>
    </ng-container>
    <ng-container *ngIf="selectedTab=='info'">

      <ion-item>
        <ion-label position="floating">Usage Cost</ion-label>
        <ion-input type="text" [(ngModel)]="item.UsageCost"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">General Comments</ion-label>
        <ion-input type="text" [(ngModel)]="item.GeneralComments"></ion-input>
      </ion-item>

    </ng-container>
  </ng-container>

</ion-content>
<ion-footer>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="previous()" *ngIf="step!='location'">
        Previous
        <ion-icon name="arrow-dropleft" slot="start"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="end">


      <ion-button (click)="next()" *ngIf="!isReadyToSubmit">
        Next
        <ion-icon name="arrow-dropright" slot="end"></ion-icon>
      </ion-button>
      <ion-button (click)="save()" *ngIf="isReadyToSubmit" color="success">
        Submit
        <ion-icon name="send" slot="end"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>